# Тестовое задание для OneFactor

[Требования][requirements.pdf]

Допустим, стартап называется Megastartup, а два его текущих клиента:

- Eighty - крупная федеральная сеть по продаже офисной техники
- Minodo Pizza - небольшая сеть пиццерий

## Глоссарий

- **Client** / **Клиент** - юр. лицо работающее с Megastartup
- **Customer** / **Покупатель** - покупатель услуг/товаров у Клиента

## Допущения и предположения

- Физическими лицами офисная техника покупается достаточно редко, а юридических лиц меньше чем физических лиц. Можно предположить, что несмотря на то Eighty намного крупнее чем Minodo Pizza по выручке, количество клиентов за период будет одного порядка
- Выгрузка в рекомендательную систему производится со следующими параметрами:
  * период выгрузки, в текущих условиях равный 1 календарному месяцу (например, "2016-08")
  * код клиента `client_code`, в настоящее время доступно два кода - "eighty", "minodo"
- Объединения и сравнения массивов Покупателей разных Клиентов не происходит – в текущих входных данных не содержится информации позволяющей это сделать. Также специфика бизнесов Клиентов сильно отличается и пользы подобного процесса нет.
- Для тестового использования в качестве файловой системы используется локальная файловая система. При промышленной эксплуатации предполагается использование HDFS.
- Все даты хранятся в формате Unix Timestamp. Для дат (без времени) такое хранение занимает больше места. по сравнению с хранением в виде строки в формате ISO 8601 (YYYY-MM-DD), но данный подход легко масштабируется без необходимости менять код.
- Все данные от Клиентов содержат в первой строке заголовок с перечислением атрибутов в файле.
- Перед началом первичной загрузки в каталоге с файлами данных создаются необходимые пустые файлы – это делается автоматически файлом запуска приложения.

## Логическая модель данных

### Типы наборов данных

Логическая модель включает в себя три типа наборов данных:

- **LOV** - List Of Values - справочнки. Статические данные, добавление новых значений возможно в ручном режиме, удаление данных не предусмотрено. В первой версии приложения таким набором будет "Регион РФ" (REGION)
- **DIM** - Dimensions - измерения. Медленно меняющиеся наборы данных, содержащих статическую информацию. В первой версии приложения таким набором будет "Покупатель" (CUSTOMER). Измерения могут содержать ссылки на LOV
- **FACT** - Facts - фактовые данные, часто меняющиеся (на добавление) данные. В первой версии приложения таким набором будет "Заказы" (ORDERS)


### Логические сущности и атрибуты

#### CUSTOMER

- Тип: DIM

| Attribute    | Data Domain | Description         | PK   |
| ------------ | ----------- | ------------------- | ---- |
| CLIENT\_CODE | Character   | Client Code         |      |
| CUST\_ID     | Character   | Customer identifier | Y    |
| REG\_DT      | Date        | Registration date   |      |
| REGION\_ID   | Numeric     | Region identifier   |      |




#### ORDERS

- Тип: FACT


| Attribute    | Data Domain | Description                     | PK   | Link To           |
| ------------ | ----------- | ------------------------------- | ---- | ----------------- |
| CUST\_ID     | Character   | Unique Customer identifier      | Y    | CUSTOMER.CUST\_ID |
| PERIOD       | Date        | First day of reporting month    | Y    |                   |
| ORDERS\_CNT  | Numeric     | Count of orders in a period     |      |                   |
| PAYMENT\_AMT | Numeric     | Amount of purchases in a period |      |                   |



## Физическая модель данных

Данные от Клиентов попадают на файловую систему в исходном формате. Для текущей реализации считаем, что исходные файлы подготовлены и находятся на локальной файловой системе.

Данные, полученные в результате ETL-процессов, сохраняются на файловую систему в виде плоских CSV-файлов. Схема файлов соответствует Логической модели за удалением избыточных атрибутов, определяемых структурой каталогов. Формат файлов описан ниже.

Структура каталогов файловой системы (относительно некоторой "домашней директории"):

* `dim/customer/<client_code>` – директория для измерения CUSTOMER, данные представлены в виде текстовых файлов вида "YYYY-MM.txt", каждый файл содержит новых Покупателей, появившихся в отчетном периоде
* `fact/orders/<client_code>` – директория содержащая факты по покупкам за отчетный период. Формат имени файла "YYYY-MM.txt", каждый файл соответствует исходному файлу полученному от Клиента

При добавлении новых типов измерений и фактов они помещаются в ту же структуру каталогов с именами в формате: `dim/<dimension_name>/<client_code>` и `fact/<fact_name>/<client_code>`.

### Физические сущности и атрибуты

Здесь и далее используются типы данных Scala.

#### customer

* Тип: DIM

| Attribute  | Data Type | Description            |
| ---------- | --------- | ---------------------- |
| CUST\_ID   | String    | Customer identifier    |
| REG\_TS    | Long      | Registration timestamp |
| REGION\_ID | Short     | Region identifier      |

Атрибуты, получаемые из пути к файлу:

* CLIENT_CODE

#### orders

* Тип: FACT

| Attribute    | Data Type | Description                     |
| ------------ | --------- | ------------------------------- |
| CUST\_ID     | String    | Customer identifier             |
| ORDERS\_CNT  | Int       | Count of orders in a period     |
| PAYMENT\_AMT | Double    | Amount of purchases in a period |

Атрибуты получаемые из пути к файлу:

* PERIOD
* CLIENT_CODE







[requirements.pdf]: https://raw.githubusercontent.com/pavel-popov/onefactor_etl/master/assets/requirements.pdf
